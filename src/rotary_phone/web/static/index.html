<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotary Phone</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">
                    <div class="logo-icon">&#9742;</div>
                    <span class="logo-text">Rotary Phone</span>
                </a>
            </div>

            <div class="sidebar-nav">
                <a class="nav-item active" onclick="navigateTo('/dashboard')">
                    <span class="nav-icon">&#9675;</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a class="nav-item" onclick="navigateTo('/calls')">
                    <span class="nav-icon">&#9743;</span>
                    <span class="nav-text">Call Log</span>
                </a>
                <a class="nav-item" onclick="navigateTo('/allowlist')">
                    <span class="nav-icon">&#9745;</span>
                    <span class="nav-text">Allowed Numbers</span>
                </a>
                <a class="nav-item" onclick="navigateTo('/speeddial')">
                    <span class="nav-icon">&#9735;</span>
                    <span class="nav-text">Speed Dial</span>
                </a>
            </div>

            <div class="sidebar-footer">
                <div class="connection-status">
                    <span class="status-dot" id="connection-dot"></span>
                    <span id="connection-text">Connected</span>
                </div>
                <div class="gear-menu-container">
                    <button class="gear-btn" onclick="toggleGearMenu(event)" title="Settings">
                        <span>&#9881;</span>
                    </button>
                    <div class="gear-menu" id="gear-menu">
                        <a class="gear-menu-item" onclick="navigateTo('/logs'); closeGearMenu();">
                            <span class="gear-menu-icon">&#9776;</span>
                            <span>View Logs</span>
                        </a>
                        <a class="gear-menu-item" onclick="navigateTo('/settings'); closeGearMenu();">
                            <span class="gear-menu-icon">&#9881;</span>
                            <span>Advanced Settings</span>
                        </a>
                        <a class="gear-menu-item" onclick="logout(); closeGearMenu();" style="border-top: 1px solid var(--border); margin-top: 4px; padding-top: 12px;">
                            <span class="gear-menu-icon">&#8618;</span>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Monitor your rotary phone status and recent activity</p>
                </div>

                <!-- Phone Status Hero -->
                <div class="status-hero">
                    <div class="phone-visual state-idle" id="phone-visual">&#9742;</div>
                    <div class="status-info">
                        <div class="status-state" id="status-state">Idle</div>
                        <div class="status-detail" id="status-detail">Phone is on hook, ready for calls</div>
                        <div class="status-number" id="status-number" style="display: none;"></div>
                        <div class="status-error" id="status-error" style="display: none;"></div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Call Statistics</div>
                            <div class="card-subtitle">Last 7 days</div>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="dash-stat-total">-</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value green" id="dash-stat-completed">-</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value amber" id="dash-stat-missed">-</div>
                            <div class="stat-label">Missed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value red" id="dash-stat-failed">-</div>
                            <div class="stat-label">Failed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="dash-stat-duration">-</div>
                            <div class="stat-label">Avg Duration</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Calls -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Recent Calls</div>
                        <button class="btn btn-secondary btn-sm" onclick="showPage('calls')">View All</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Direction</th>
                                    <th>Number</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recent-calls-body">
                                <tr><td colspan="5" class="table-empty">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Call Log Page -->
            <div id="page-calls" class="page">
                <div class="page-header">
                    <h1 class="page-title">Call Log</h1>
                    <p class="page-subtitle">View and search your call history</p>
                </div>

                <div id="calls-message"></div>

                <div class="card">
                    <div class="filters">
                        <input type="text" class="filter-input" id="call-search"
                               placeholder="Search phone number..." onkeyup="debounceSearch()">
                        <select class="filter-select" id="call-direction" onchange="loadCallLog()">
                            <option value="">All Directions</option>
                            <option value="inbound">Inbound</option>
                            <option value="outbound">Outbound</option>
                        </select>
                        <select class="filter-select" id="call-status" onchange="loadCallLog()">
                            <option value="">All Statuses</option>
                            <option value="completed">Completed</option>
                            <option value="missed">Missed</option>
                            <option value="failed">Failed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadCallLog()">&#8635; Refresh</button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Direction</th>
                                    <th>Number</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="call-log-body">
                                <tr><td colspan="5" class="table-empty">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination">
                        <button class="btn btn-secondary btn-sm" id="prev-page" onclick="prevPage()" disabled>Previous</button>
                        <span class="pagination-info" id="page-info">Page 1</span>
                        <button class="btn btn-secondary btn-sm" id="next-page" onclick="nextPage()" disabled>Next</button>
                    </div>
                </div>
            </div>

            <!-- Allowlist Page -->
            <div id="page-allowlist" class="page">
                <div class="page-header">
                    <h1 class="page-title">Allowed Numbers</h1>
                    <p class="page-subtitle">Control which numbers can be dialed</p>
                </div>

                <div id="allowlist-message"></div>

                <div class="card">
                    <div class="toggle-row">
                        <div>
                            <div class="toggle-label">Allow All Numbers</div>
                            <div class="toggle-description">Disable restrictions and allow dialing any number</div>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="allow-all-toggle" onchange="toggleAllowAll()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div id="allowlist-entries-container" style="margin-top: 20px;">
                        <div class="form-label">Allowed Phone Numbers</div>
                        <div id="allowlist-entries"></div>
                        <button class="btn btn-secondary btn-sm" onclick="addAllowlistEntry()" style="margin-top: 12px;">
                            + Add Number
                        </button>
                    </div>

                    <div style="margin-top: 24px; display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="saveAllowlist()">Save Changes</button>
                        <button class="btn btn-secondary" onclick="loadAllowlist()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Speed Dial Page -->
            <div id="page-speeddial" class="page">
                <div class="page-header">
                    <h1 class="page-title">Speed Dial</h1>
                    <p class="page-subtitle">Quick dial shortcuts (1-2 digit codes)</p>
                </div>

                <div id="speeddial-message"></div>

                <div class="card">
                    <div id="speed-dial-entries"></div>
                    <button class="btn btn-secondary btn-sm" onclick="addSpeedDialEntry()" style="margin-top: 12px;">
                        + Add Speed Dial
                    </button>
                    <div style="margin-top: 24px; display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="saveSpeedDial()">Save Changes</button>
                        <button class="btn btn-secondary" onclick="loadSpeedDial()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Logs Page -->
            <div id="page-logs" class="page">
                <div class="page-header">
                    <h1 class="page-title">System Logs</h1>
                    <p class="page-subtitle">View real-time application logs</p>
                </div>

                <div class="card">
                    <div class="log-controls">
                        <div class="log-controls-left">
                            <select id="log-level-filter" onchange="filterLogs()">
                                <option value="">All Levels</option>
                                <option value="DEBUG">Debug</option>
                                <option value="INFO">Info</option>
                                <option value="WARNING">Warning</option>
                                <option value="ERROR">Error</option>
                            </select>
                            <input type="text" id="log-search" placeholder="Search logs..." onkeyup="filterLogs()">
                        </div>
                        <div class="log-controls-right">
                            <div class="log-level-control">
                                <label>Log Level:</label>
                                <select id="runtime-log-level" onchange="changeLogLevel()">
                                    <option value="DEBUG">Debug</option>
                                    <option value="INFO" selected>Info</option>
                                    <option value="WARNING">Warning</option>
                                    <option value="ERROR">Error</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary btn-sm" id="log-stream-btn" onclick="toggleLogStream()">
                                <span id="stream-icon">&#9654;</span> Stream
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="clearLogDisplay()">Clear</button>
                        </div>
                    </div>

                    <div class="log-viewer" id="log-viewer">
                        <div class="log-loading">Loading logs...</div>
                    </div>

                    <div class="log-status">
                        <span id="log-count">0 entries</span>
                        <span id="log-stream-status">Disconnected</span>
                    </div>
                </div>
            </div>

            <!-- Settings Page (Advanced Settings) -->
            <div id="page-settings" class="page">
                <div class="page-header">
                    <h1 class="page-title">Advanced Settings</h1>
                    <p class="page-subtitle">Configure sounds, timing, and system options</p>
                </div>

                <div id="settings-message"></div>

                <!-- Sounds Section -->
                <div class="settings-section open" id="section-sounds">
                    <div class="settings-header" onclick="toggleSection('sounds')">
                        <div class="settings-header-left">
                            <div class="settings-icon">&#128266;</div>
                            <div>
                                <div class="settings-title">Sounds & Ring Settings</div>
                                <div class="settings-description">Manage ringtones, audio files, and ring timing</div>
                            </div>
                        </div>
                        <span class="settings-chevron">&#9660;</span>
                    </div>
                    <div class="settings-content">
                        <!-- Ring Settings -->
                        <div class="form-label">Ring Settings</div>
                        <div class="ring-settings-grid">
                            <div class="ring-setting-row">
                                <div class="ring-setting-info">
                                    <label for="ring-duration">Ring Duration</label>
                                    <span class="ring-setting-hint">How long the ring sound plays (seconds)</span>
                                </div>
                                <div class="ring-setting-control">
                                    <input type="number" id="ring-duration" min="0.5" max="30" step="0.5" value="2">
                                    <span class="ring-setting-unit">s</span>
                                </div>
                            </div>
                            <div class="ring-setting-row">
                                <div class="ring-setting-info">
                                    <label for="ring-pause">Ring Pause</label>
                                    <span class="ring-setting-hint">Silence between rings (seconds)</span>
                                </div>
                                <div class="ring-setting-control">
                                    <input type="number" id="ring-pause" min="0.5" max="60" step="0.5" value="4">
                                    <span class="ring-setting-unit">s</span>
                                </div>
                            </div>
                        </div>
                        <div class="ring-settings-actions">
                            <button class="btn btn-primary btn-sm" onclick="saveRingSettings()">Save Ring Settings</button>
                            <button class="btn btn-secondary btn-sm" onclick="testRing()">&#9654; Test Ring</button>
                        </div>

                        <div style="margin-top: 32px;">
                            <div class="form-label">Audio Levels</div>
                            <div class="ring-settings-grid">
                                <div class="ring-setting-row">
                                    <div class="ring-setting-info">
                                        <label for="input-gain">Microphone Gain</label>
                                        <span class="ring-setting-hint">Input volume from handset mic (0.0-2.0)</span>
                                    </div>
                                    <div class="ring-setting-control">
                                        <input type="range" id="input-gain-slider" min="0" max="2" step="0.1" value="1"
                                               oninput="document.getElementById('input-gain').value = this.value">
                                        <input type="number" id="input-gain" min="0" max="2" step="0.1" value="1"
                                               oninput="document.getElementById('input-gain-slider').value = this.value">
                                    </div>
                                </div>
                                <div class="ring-setting-row">
                                    <div class="ring-setting-info">
                                        <label for="output-volume">Speaker Volume</label>
                                        <span class="ring-setting-hint">Output volume to handset speaker (0.0-2.0)</span>
                                    </div>
                                    <div class="ring-setting-control">
                                        <input type="range" id="output-volume-slider" min="0" max="2" step="0.1" value="1"
                                               oninput="document.getElementById('output-volume').value = this.value">
                                        <input type="number" id="output-volume" min="0" max="2" step="0.1" value="1"
                                               oninput="document.getElementById('output-volume-slider').value = this.value">
                                    </div>
                                </div>
                            </div>
                            <div class="ring-settings-actions">
                                <button class="btn btn-primary btn-sm" onclick="saveAudioGain()">Save Audio Levels</button>
                            </div>
                        </div>

                        <div style="margin-top: 32px;">
                            <!-- Sound Assignments -->
                            <div class="form-label">Sound Assignments</div>
                            <div class="sound-assignments">
                                <div class="assignment-row">
                                    <label>Ring Sound</label>
                                    <select id="assign-ring_sound" onchange="saveSoundAssignments()">
                                        <option value="">-- None --</option>
                                    </select>
                                </div>
                                <div class="assignment-row">
                                    <label>Dial Tone</label>
                                    <select id="assign-dial_tone" onchange="saveSoundAssignments()">
                                        <option value="">-- None --</option>
                                    </select>
                                </div>
                                <div class="assignment-row">
                                    <label>Busy Tone</label>
                                    <select id="assign-busy_tone" onchange="saveSoundAssignments()">
                                        <option value="">-- None --</option>
                                    </select>
                                </div>
                                <div class="assignment-row">
                                    <label>Error Tone</label>
                                    <select id="assign-error_tone" onchange="saveSoundAssignments()">
                                        <option value="">-- None --</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 24px;">
                            <div class="form-label">Sound Files</div>
                            <div id="sound-list"></div>
                        </div>

                        <!-- Hidden audio element for playback -->
                        <audio id="sound-player" style="display: none;"></audio>

                        <div style="margin-top: 24px;">
                            <div class="form-label">Upload New Sound</div>
                            <label class="upload-zone">
                                <input type="file" id="sound-file" accept=".wav" onchange="uploadSound()">
                                <div class="upload-icon">&#128190;</div>
                                <div class="upload-text">Click to upload WAV file</div>
                                <div class="upload-hint">Only .wav files are supported</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Network Section -->
                <div class="settings-section open" id="section-network">
                    <div class="settings-header" onclick="toggleSection('network')">
                        <div class="settings-header-left">
                            <div class="settings-icon">&#128246;</div>
                            <div>
                                <div class="settings-title">Network & WiFi</div>
                                <div class="settings-description">Manage WiFi connections and access point settings</div>
                            </div>
                        </div>
                        <span class="settings-chevron">&#9660;</span>
                    </div>
                    <div class="settings-content">
                        <!-- Current Connection Status -->
                        <div class="form-label">Current Connection</div>
                        <div class="network-status" id="network-status">
                            <div class="network-status-loading">Loading network status...</div>
                        </div>

                        <!-- WiFi Network Scanner -->
                        <div style="margin-top: 24px;">
                            <div class="form-label">Available Networks</div>
                            <button class="btn btn-secondary btn-sm" onclick="scanNetworks()" id="scan-btn">
                                &#128268; Scan for Networks
                            </button>
                            <div id="network-list" style="margin-top: 12px;"></div>
                        </div>

                        <!-- WiFi Connection Form -->
                        <div id="connect-form" style="display: none; margin-top: 24px;">
                            <div class="form-label">Connect to Network</div>
                            <div class="network-connect-form">
                                <div class="form-group">
                                    <label for="connect-ssid">Network Name (SSID)</label>
                                    <input type="text" id="connect-ssid" placeholder="Network name" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="connect-password">Password</label>
                                    <input type="password" id="connect-password" placeholder="WiFi password">
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-primary" onclick="connectToNetwork()">Connect</button>
                                    <button class="btn btn-secondary" onclick="cancelConnect()">Cancel</button>
                                </div>
                            </div>
                        </div>

                        <!-- Access Point Mode -->
                        <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid var(--border);">
                            <div class="form-label">Access Point Mode</div>
                            <div id="ap-status" class="network-status">
                                <div class="network-status-loading">Loading AP status...</div>
                            </div>
                            <div class="form-actions" style="margin-top: 12px;">
                                <button class="btn btn-primary" id="ap-start-btn" onclick="startAccessPoint()" style="display: none;">
                                    Start Access Point
                                </button>
                                <button class="btn btn-danger" id="ap-stop-btn" onclick="stopAccessPoint()" style="display: none;">
                                    Stop Access Point
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Info Section -->
                <div class="settings-section open" id="section-system">
                    <div class="settings-header" onclick="toggleSection('system')">
                        <div class="settings-header-left">
                            <div class="settings-icon">&#128296;</div>
                            <div>
                                <div class="settings-title">System Information</div>
                                <div class="settings-description">View current configuration</div>
                            </div>
                        </div>
                        <span class="settings-chevron">&#9660;</span>
                    </div>
                    <div class="settings-content">
                        <div class="config-grid" id="system-config"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Call Details Modal -->
    <div class="modal-overlay" id="call-modal" onclick="closeCallModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">Call Details</h3>
                <button class="modal-close" onclick="closeCallModal()">&times;</button>
            </div>
            <div class="modal-body" id="call-modal-content"></div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="deleteCall()">Delete</button>
                <button class="btn btn-secondary" onclick="closeCallModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
